<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="/styles.css">
</head>
<body>
<header><h1>Admin Dashboard</h1></header>
<section class="card">
<h2>All Orders</h2>
<div id="orders"></div>
</section>

<script>
async function loadOrders() {
  const res = await fetch('/functions/get-orders');
  return await res.json();
}

async function renderOrders() {
  const orders = await loadOrders();
  const container = document.getElementById('orders');
  container.innerHTML = '';
  orders.forEach(order => {
    const div = document.createElement('div');
    div.className = 'order';
    div.innerHTML = `
      <strong>ID:</strong> ${order.id}<br>
      <strong>Email:</strong> ${order.email}<br>
      <strong>Discord:</strong> ${order.discord}<br>
      <strong>Platform:</strong> ${order.platform}<br>
      <strong>Package:</strong> ${order.package}<br>
      <strong>Transfer Method:</strong> ${order.transferMethod}<br>
      <strong>Status:</strong> ${order.status}<br>
      <strong>Date:</strong> ${new Date(order.created).toLocaleString()}<br>
      <button onclick="markCompleted('${order.id}')" class="btn-small">Mark Completed</button>
      <button onclick="confirmDeleted('${order.id}')" class="btn-small">Confirm Credentials Deleted</button>
      <hr>`;
    container.appendChild(div);
  });
}

async function markCompleted(id) {
  await fetch('/functions/update-order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,action:'completed'})});
  renderOrders();
}

async function confirmDeleted(id) {
  await fetch('/functions/update-order',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id,action:'deleted'})});
  renderOrders();
}

renderOrders();
</script>
</body>
</html>
